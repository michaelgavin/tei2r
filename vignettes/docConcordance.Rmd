---
title: "The docConcordance Object"
author: "Travis Mullen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{"The docConcordance Object"}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Introduction
***
The `docConcordance` object shows you the words that occur within a certain number of words (or `context`) of a key word (or `term`).  You can use the `docConcordance` object to explore the way that your key word is used in each of the documents in your corpus. For each document, you will see a list of words that occur on each side of your key term in the document. Looking at the data in this way can give you a good understaning of the key term's contextual meaning in its various appearances in each document.  Comparing the term's concordance between documents can help you discover differences in use of the key term between documents.

To use the `docConcordance` object, you'll need to have a `docList` and a `docText` object.  You can create the `docConcordance` object by simply running `dc = buildConcordance(dt, 'term', n)`.  To see the concordance for a particular document, you can run `dc@concordance$ID` where `ID` is the ID number from your `index` file.

A more technical description can be found below in the 'What it is' section.

##What it is
The `docConcordance` object is an essential part of the `tei2r` package and is important for the analysis of term use across a corpus. The `docConcordance` object holds the concordance for single term in each document across the collection of documents.The concordance of a term is made up of the Key Words In Context (KWIC) for that word in each document.  This is determined by finding the term each time it occurs in the text and taking a certain number of words (the `context`) on each side of the term where it appears.  The result is a list of lists that is the length of the number of documents in your corpus.  

Understanding a list of lists can be a little difficult.  It is helpful to see some R output.  For example, `dc@concordance[1]`^[dc was generated using `dc = buildConcordance(dt, 'just', 5)] will return:
```
$A26092
$A26092[[1]]
 [1] "real"         "interest"      "perfection"    "excellent"   "author"      "just"        "now"     "mentioned"
 [9] "sufficiently" "nsorm"         "course"
 
$A26092[[2]]
 [1] "arbitrary"  "sway"       "know"       "assert"     "authority"  "just"       "occasion"   "prejudice"  "charge" "indiscreet"
[11] "remissness"
```

This output gives us some clues into the structure of the list of lists.  First, each list has a name (`$A26092`) that corresponds to the `id` field in our index.  Second, each interior list has an index that is double bracketed (`[[1]]` or `[[2]]` in this case).  To access a single list of the first list in our `docConcordance` object, we can run:
```r
  dc@concordance[[1]][[1]] # But we lose the names here. OR,
  dc@concordance$A26092[[1]]
```

The second of these options is more helpful when exploring the concordance because it maintains the `id` of the document in the command.

The `docConcordance` object has several slots where information is stored:

  - `directory` a string that gives the full path to the main directory (folder) that houses your corpus of texts.
  - `indexFile` a string that gives the full path to the file that contains your index file (the meta-data for your corpus).
  - `term` a string that holds the term that is used to generate the concordance.  This is helpful for keeping track of your `docConcordance` objects if you have more than one.  For example, if I have two `docConcordance` objects, one that is the concordance of the term "just" in a corpus of Locke and his contemporaries and one that is the concordance of the term "right" in the same corpus, I can figure out which object is which by saying `dc1@term` or `dc2@term` (where `dc1` and `dc2` are the names of the different objects).
  - `context` the context used to generate the concordance in each document.  The context is the number of words on each side of the search term to include in the concordance.  Take, for example, the sentence: "Jack runs faster than Jane does sometimes." If we had `context=2` and `term = "than"`, the return would be `["runs", "faster", "than", "Jane", "does"]` (`[-2]than[+2]`).
***

# `docConcordance`'s Slots

## `term`
The `term` slot holds the term that was used to generate the concordance.  It is the term that is at the center of each of the Key Word in Context lists for each document that are held in the `concordance` slot.

## `context`
The `context` slot holds the numerical distance used to determine the concordance.  It is the number of words that are taken on each side of the `term` of interest from each of the `term`'s appearances in the document.  The length of each set of KWICs will be `(2*context) + 1` because the algorithm will take `context` words before `term` and `context` words after term.  So if the context is 5, each KWIC list will be 11 words long.

## `concordance`
The `concordance` of a term is made up of the words that co-occur with it in a document.  Each time that `term` appears, a list is generated of the `context` number of words that come before and after it in the text.  This allows you to gain an understanding of how the term is used in each document and across the whole corpus.  Take the example above:

```
$A26092
$A26092[[1]]
 [1] "real"         "interest"      "perfection"    "excellent"   "author"      "just"        "now"     "mentioned"
 [9] "sufficiently" "nsorm"         "course"
 
$A26092[[2]]
 [1] "arbitrary"  "sway"       "know"       "assert"     "authority"  "just"       "occasion"   "prejudice"  "charge" "indiscreet"
[11] "remissness"
```

Here, Wollstonecraft employs `just` only twice in her whole text.  The first instance appears to be consistent with the modern use of "just" as in immedaitely preceeding, or only.  We can see that by examining the words immediately surrounding "just": ["excellent", "author"] and ["now", "mentioned"].  This sequence of words follows the formulat "x just now mentioned".  The second use indicates a use of `just` in a different way, one that suggests appropriateness or accuracy (["assert", "authority"] when there is "just" ["occasion"].

It is important to note that the `docConcordance` object and its algorithm will not pick up on variant spellings or usages (i.e. "iust" or "justice" or "unjust").  It is, however, sensitive to capitalization so will find (given 'just' as `term`) "just" but not "Just".

## Diagram

![docConcordance structure](./img/dc_diagram.png)  
The object structure of the `docConcordance` object and how to access its elements.

## Examples

```r
  > library(tools)
  > library(XML)
  
  > dl = buildDocList(directory = "./data/sampleSetOne/", 
                  indexFile="./data/sampleSetOne/index.csv", 
                  stopwordsFile = "./data/stopword_list.txt")
  > dt = getTexts(dl)
  > dc = getConcordance(dt = dt, term = 'just', context = 5)
```

***
# Extending `docConcordance` with analysis
The `docConcordance` object is a powerful tool for analyzing your set of documents...

The first step of any analysis with the `docConcordance` object should be finding the associations for your `term` using the [`docAssociation`]('docAssociation.html') object.  The associations for your `term` can help you build a vocabulary (or definition) by providing you with the frequencies with which words co-occur with your `term` in each document and across all documents.

You can also use the 'docConcordance' object for term frequency inverse document frequency.  To do this, you will run the command: `tf = tfidf(dc, all=T)` or `tf = tfidf(dc, 'term', all=F)`.  We recommend running the command with `all=T` so that you can see the tfidf for all of the terms that cluster around your given term.  If you'd like to see a specific word's tfidf within its the clusters around your given `term`, the second option is your best choice.
